<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mortgage Lead Generation & Analysis</title>
  <link rel="stylesheet" href="/style.css" />
  <style>
    select[multiple] { height: 120px; }
    .hint { font-size: 12px; opacity: 0.8; margin-top: 4px; }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Mortgage Lead Generation & Analysis</h1>
      <p>Identify qualified leads and analyze refinancing opportunities</p>
    </header>

    <nav class="tabs">
      <button class="tab-btn active" data-tab="leadGen">Lead Generation</button>
      <button class="tab-btn" data-tab="builder">Payload Builder</button>
      <button class="tab-btn" data-tab="customers">Customer Management</button>
    </nav>

    <!-- ===== SCREEN 1: LEAD GENERATION ===== -->
    <section id="leadGenSection" class="tab-content active">
      <div class="screen-header">
        <h2>Lead Generation</h2>
        <p>Find customers who can save minimum monthly amount</p>
      </div>

      <div class="controls">
        <form id="leadGenForm">
          <div class="form-row">
            <div class="form-group">
              <label for="lgPayloadSelect">Select Payload Template:</label>
              <select id="lgPayloadSelect" required>
                <option value="">-- Select a Payload --</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="lgMinSavings">Min Monthly Savings ($):</label>
              <input type="number" id="lgMinSavings" value="200" step="10" required />
            </div>
            <div class="form-group">
              <label for="lgTargetAmount">Target Amount (Credit/Cost) ($):</label>
              <input type="number" id="lgTargetAmount" value="-2000" step="100" required />
            </div>
          </div>

          <button type="submit" class="btn-primary">Find Qualified Leads</button>
        </form>
      </div>

      <div id="leadGenResults" class="hidden">
        <div class="results-header">
          <h3>Qualified Leads (<span id="leadCount">0</span>)</h3>
          <button id="exportLeadsBtn" class="btn-secondary">Export to CSV</button>
        </div>

        <div class="table-container">
          <table class="results-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Current Payment</th>
                <th>New Payment</th>
                <th>Monthly Savings</th>
                <th>Annual Savings</th>
                <th>Product</th>
                <th>Buydown</th>
                <th>Rate</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="leadGenTableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ===== SCREEN 2: PAYLOAD BUILDER ===== -->
    <section id="builderSection" class="tab-content">
      <div class="screen-header">
        <h2>Payload Builder</h2>
        <p>Configure and save payload templates for analysis</p>
      </div>

      <div class="controls">
        <div class="saved-payloads">
          <label for="payloadSelect">Saved Payloads:</label>
          <div class="form-row">
            <select id="payloadSelect" style="flex: 1;">
              <option value="">-- Select a Payload --</option>
            </select>
            <button type="button" id="deletePayloadBtn" class="btn-secondary">Delete</button>
          </div>
        </div>

        <div class="json-import-area">
          <label for="jsonImportText">Import Payload JSON:</label>
          <textarea id="jsonImportText" placeholder='Paste JSON here... e.g. {"borrowerName": "John", ...}' rows="4"></textarea>
          <button type="button" id="loadJsonBtn" class="btn-secondary">Load JSON into Form</button>
        </div>

        <form id="builderForm">
          <div class="form-row">
            <div class="form-group">
              <label for="payloadName">Payload Name</label>
              <input type="text" id="payloadName" placeholder="e.g. Standard Refi Template" required />
            </div>

            <div class="form-group">
              <label for="borrowerName">Borrower Name</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="borrowerName" checked />
                <input type="text" id="borrowerName" name="borrowerName" value="John Homeowner" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="brokerAlias">Broker Alias</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="brokerAlias" checked />
                <input type="text" id="brokerAlias" name="brokerAlias" value="ABC123" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="loanOfficer">Loan Officer Email</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="loanOfficer" checked />
                <input type="text" id="loanOfficer" name="loanOfficer" value="lofficer@email.com" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="loanAmount">Loan Amount ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="loanAmount" checked />
                <input type="number" id="loanAmount" name="loanAmount" value="300000" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="loanTypeIds">Loan Type (Array)</label>
              <div style="display:flex; align-items:flex-start; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="loanTypeIds" checked />
                <div style="flex:1;">
                  <select id="loanTypeIds" name="loanTypeIds" multiple>
                    <option value="0" selected>Conventional</option>
                    <option value="1">Conventional ARM</option>
                    <option value="2">FHA</option>
                    <option value="3">FHA ARM</option>
                    <option value="4">VA</option>
                    <option value="5">VA ARM</option>
                    <option value="6">USDA</option>
                  </select>
                  <small class="hint">Hold Ctrl/Cmd to select multiple</small>
                </div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="purposeTypeID">Purpose</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="purposeTypeID" checked />
                <select id="purposeTypeID" name="purposeTypeID" style="flex:1;">
                  <option value="1">Purchase Home</option>
                  <option value="3" selected>Refinance 1st Mortgage</option>
                  <option value="6">Construction Purchase</option>
                  <option value="12">Construction Refinance</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="refinancePurposeId">Refinance Purpose</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="refinancePurposeId" checked />
                <select id="refinancePurposeId" name="refinancePurposeId" style="flex:1;">
                  <option value="Cash Out">Cash Out</option>
                  <option value="Rate And Term Reduction-CONV" selected>Rate And Term Reduction-CONV</option>
                  <option value="Rate And Term Reduction-FHA">Rate And Term Reduction-FHA</option>
                  <option value="Streamline Refinance">Streamline Refinance</option>
                  <option value="VA Interest Rate Reduction">VA Interest Rate Reduction</option>
                  <option value="VA Cash Out - Type I">VA Cash Out - Type I</option>
                  <option value="VA Cash Out - Type II">VA Cash Out - Type II</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="salesPrice">Sales Price ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="salesPrice" checked />
                <input type="number" id="salesPrice" name="salesPrice" value="325000" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="appraisedValue">Appraised Value ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="appraisedValue" checked />
                <input type="number" id="appraisedValue" name="appraisedValue" value="325000" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="propertyTypeId">Property Type</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="propertyTypeId" checked />
                <select id="propertyTypeId" name="propertyTypeId" style="flex:1;">
                  <option value="22" selected>Single Family Residence</option>
                  <option value="25">2â€“4 Unit Dwelling</option>
                  <option value="30">Cooperative</option>
                  <option value="32">PUD</option>
                  <option value="34">Condominium</option>
                  <option value="38">Modular</option>
                  <option value="48">Site Condo</option>
                  <option value="52">Manufactured Condo Single Wide</option>
                  <option value="53">Manufactured PUD Single Wide</option>
                  <option value="54">Manufactured Single Wide</option>
                  <option value="55">Manufactured Multi Wide</option>
                  <option value="56">Manufactured Condo Multi Wide</option>
                  <option value="57">Manufactured PUD Multi Wide</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="occupancyTypeId">Occupancy</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="occupancyTypeId" checked />
                <select id="occupancyTypeId" name="occupancyTypeId" style="flex:1;">
                  <option value="1" selected>Primary Residence</option>
                  <option value="2">Investment Property</option>
                  <option value="3">Secondary Residence</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="creditScore">Credit Score</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="creditScore" checked />
                <input type="number" id="creditScore" name="creditScore" value="750" min="300" max="850" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="propertyZipCode">Zip Code</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="propertyZipCode" checked />
                <input type="text" id="propertyZipCode" name="propertyZipCode" value="48341" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="numberOfUnits">Number of Units</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="numberOfUnits" checked />
                <input type="number" id="numberOfUnits" name="numberOfUnits" value="1" min="1" max="4" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="attachmentTypeId">Attachment Type</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="attachmentTypeId" checked />
                <select id="attachmentTypeId" name="attachmentTypeId" style="flex:1;">
                  <option value="0" selected>Attached</option>
                  <option value="1">Detached</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="prepaymentPenaltyId">Prepayment Penalty</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="prepaymentPenaltyId" checked />
                <select id="prepaymentPenaltyId" name="prepaymentPenaltyId" style="flex:1;">
                  <option value="1" selected>None</option>
                  <option value="2">1 Year Penalty</option>
                  <option value="4">2 Year Penalty</option>
                  <option value="7">3 Year Penalty</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="numberOfFinancedProperties">Financed Properties</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="numberOfFinancedProperties" checked />
                <input type="number" id="numberOfFinancedProperties" name="numberOfFinancedProperties" value="1" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="leaseTypeId">Lease Type (Investor Flex)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="leaseTypeId" checked />
                <select id="leaseTypeId" name="leaseTypeId" style="flex:1;">
                  <option value="1" selected>Unleased</option>
                  <option value="2">Long-Term Lease</option>
                  <option value="3">Short-Term Rental</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="debtServiceCoverageRatio">DSCR (Decimal)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="debtServiceCoverageRatio" checked />
                <input type="number" id="debtServiceCoverageRatio" name="debtServiceCoverageRatio" value="2.00" step="0.01" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="mortgageInsuranceType">Mortgage Insurance</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="mortgageInsuranceType" checked />
                <select id="mortgageInsuranceType" name="mortgageInsuranceType" style="flex:1;">
                  <option value="1" selected>BPMI (Monthly)</option>
                  <option value="2">LPMI Lender Paid</option>
                  <option value="3">Split 50</option>
                  <option value="4">Split 100</option>
                  <option value="5">Single Premium</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="controlYourPrice">CYP Bps (0-40)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="controlYourPrice" checked />
                <input type="number" id="controlYourPrice" name="controlYourPrice" value="0" min="0" max="40" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="commitmentPeriodId">Lock Period</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="commitmentPeriodId" checked />
                <select id="commitmentPeriodId" name="commitmentPeriodId" style="flex:1;">
                  <option value="13" selected>30-Day</option>
                  <option value="21">8-Day</option>
                  <option value="20">11-Day</option>
                  <option value="12">15-Day</option>
                  <option value="19">22-Day</option>
                  <option value="14">45-Day</option>
                  <option value="15">60-Day</option>
                  <option value="16">90-Day</option>
                  <option value="17">120-Day</option>
                  <option value="18">180-Day</option>
                  <option value="22">150-Day</option>
                  <option value="23">270-Day</option>
                  <option value="24">365-Day</option>
                  <option value="-1">Custom</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="secondLoanAmount">Second Loan Amount ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="secondLoanAmount" checked />
                <input type="number" id="secondLoanAmount" name="secondLoanAmount" value="0" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="monthlyIncome">Monthly Income ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="monthlyIncome" checked />
                <input type="number" id="monthlyIncome" name="monthlyIncome" value="4000" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="monthlyDebt">Monthly Debt ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="monthlyDebt" checked />
                <input type="number" id="monthlyDebt" name="monthlyDebt" value="0" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="annualTaxes">Annual Taxes ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="annualTaxes" checked />
                <input type="number" id="annualTaxes" name="annualTaxes" value="0" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="annualHomeownersInsurance">Annual Homeowners Ins ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="annualHomeownersInsurance" checked />
                <input type="number" id="annualHomeownersInsurance" name="annualHomeownersInsurance" value="0" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="annualPercentageRateFees">APR Fees ($)</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="annualPercentageRateFees" checked />
                <input type="number" id="annualPercentageRateFees" name="annualPercentageRateFees" value="0" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="monthsOfBankStatementsId">Bank Statement Months</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="monthsOfBankStatementsId" checked />
                <select id="monthsOfBankStatementsId" name="monthsOfBankStatementsId" style="flex:1;">
                  <option value="0" selected>None</option>
                  <option value="12">12 Months</option>
                  <option value="24">24 Months</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="monthsOfReservesId">Months of Reserves</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="monthsOfReservesId" checked />
                <input type="number" id="monthsOfReservesId" name="monthsOfReservesId" value="0" step="0.1" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="numberOfBorrowers">Number of Borrowers</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="numberOfBorrowers" checked />
                <select id="numberOfBorrowers" name="numberOfBorrowers" style="flex:1;">
                  <option value="1" selected>One Borrower</option>
                  <option value="2">Two Borrowers</option>
                  <option value="3">Three Borrowers</option>
                  <option value="4">Four Borrowers</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="compensationPayerTypeID">Comp Payer</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="compensationPayerTypeID" checked />
                <select id="compensationPayerTypeID" name="compensationPayerTypeID" style="flex:1;">
                  <option value="0">Borrower Paid</option>
                  <option value="1" selected>Lender Paid</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="exactRateTypeId">Exact Rate Type</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="exactRateTypeId" checked />
                <select id="exactRateTypeId" name="exactRateTypeId" style="flex:1;">
                  <option value="2" selected>Target Price After Compensation</option>
                  <option value="1">Target Rate</option>
                  <option value="0">None</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="buyDownAliasID">Buydown Type</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="buyDownAliasID" checked />
                <select id="buyDownAliasID" name="buyDownAliasID" style="flex:1;">
                  <option value="None" selected>None</option>
                  <option value="1-0">1-0</option>
                  <option value="1-0 LLPA">1-0 LLPA</option>
                  <option value="1-1">1-1</option>
                  <option value="1-1 LLPA">1-1 LLPA</option>
                  <option value="2-1">2-1</option>
                  <option value="2-1 LLPA">2-1 LLPA</option>
                  <option value="3-2-1">3-2-1</option>
                  <option value="3-2-1 LLPA">3-2-1 LLPA</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="targetPriceValue">Target Price Value</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="targetPriceValue" checked />
                <input type="number" id="targetPriceValue" name="targetPriceValue" value="0" step="0.001" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="targetCashValue">Target Cash Value</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="targetCashValue" checked />
                <input type="number" id="targetCashValue" name="targetCashValue" value="0" style="flex:1;" />
              </div>
            </div>

            <div class="form-group">
              <label for="targetRateValue">Target Rate Value</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="targetRateValue" checked />
                <input type="number" id="targetRateValue" name="targetRateValue" value="0" step="0.001" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="escrowWaiverTypeId">Escrow Waiver</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="escrowWaiverTypeId" checked />
                <select id="escrowWaiverTypeId" name="escrowWaiverTypeId" style="flex:1;">
                  <option value="1" selected>No Waiver</option>
                  <option value="2">Waive Taxes Only</option>
                  <option value="3">Waive Hazard Insurance Only</option>
                  <option value="4">Waive Taxes & Hazard Insurance</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="loanTermIds">Loan Term Ids (Array)</label>
              <div style="display:flex; align-items:flex-start; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="loanTermIds" checked />
                <div style="flex:1;">
                  <select id="loanTermIds" name="loanTermIds" multiple>
                    <option value="5">40 Years (Conventional only)</option>
                    <option value="4" selected>30 Years</option>
                    <option value="3">25 Years</option>
                    <option value="2">20 Years</option>
                    <option value="1">15 Years</option>
                    <option value="0">10 Years</option>
                  </select>
                  <small class="hint">Hold Ctrl/Cmd to select multiple</small>
                </div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="waivableFeeTypeIds">Waivable Fee Type Ids (Array)</label>
              <div style="display:flex; align-items:flex-start; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="waivableFeeTypeIds" checked />
                <div style="flex:1;">
                  <select id="waivableFeeTypeIds" name="waivableFeeTypeIds" multiple>
                    <option value="0" selected>Underwriting Fee</option>
                    <option value="2">TRAC+ Fee</option>
                    <option value="3">PA+ Fee</option>
                  </select>
                  <small class="hint">Hold Ctrl/Cmd to select multiple</small>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="loanShieldTypeId">Loan Shield</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="loanShieldTypeId" checked />
                <select id="loanShieldTypeId" name="loanShieldTypeId" style="flex:1;">
                  <option value="0" selected>Do not include Loan Shield</option>
                  <option value="1">Include Loan Shield</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="paPlusTypeId">PA+ Type</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="paPlusTypeId" checked />
                <select id="paPlusTypeId" name="paPlusTypeId" style="flex:1;">
                  <option value="0" selected>In-House</option>
                  <option value="1">PA+ Full Service</option>
                  <option value="6">PA+ Setup and Underwriting</option>
                  <option value="7">PA+ Setup and Closing</option>
                  <option value="8">PA+ Underwriting and Closing</option>
                  <option value="2">PA+ Setup Only</option>
                  <option value="3">PA+ Underwriting Only</option>
                  <option value="4">PA+ Closing Only</option>
                  <option value="5">Third-Party Processor</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="financedMortgageInsuranceTypeId">VA Funding Fee Type</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="financedMortgageInsuranceTypeId" checked />
                <select id="financedMortgageInsuranceTypeId" name="financedMortgageInsuranceTypeId" style="flex:1;">
                  <option value="6" selected>Financed</option>
                  <option value="7">Non-Financed</option>
                  <option value="12">Exempt</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="useMortgageInsuranceTypeIds">VA Use Type Ids (Array)</label>
              <div style="display:flex; align-items:flex-start; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="useMortgageInsuranceTypeIds" checked />
                <div style="flex:1;">
                  <select id="useMortgageInsuranceTypeIds" name="useMortgageInsuranceTypeIds" multiple>
                    <option value="8" selected>First Use</option>
                    <option value="9">Subsequent Use</option>
                  </select>
                  <small class="hint">Hold Ctrl/Cmd to select multiple</small>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="federalHousingAdministrationSecondarySourceTypeId">FHA Secondary Source</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="federalHousingAdministrationSecondarySourceTypeId" checked />
                <select id="federalHousingAdministrationSecondarySourceTypeId" name="federalHousingAdministrationSecondarySourceTypeId" style="flex:1;">
                  <option value="1" selected>Government</option>
                  <option value="2">Non-Profit</option>
                  <option value="3">Family/Relative</option>
                  <option value="4">Employee/Other</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="tracTypeId">TRAC Type</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="tracTypeId" checked />
                <select id="tracTypeId" name="tracTypeId" style="flex:1;">
                  <option value="0" selected>Traditional Lenders Policy</option>
                  <option value="2">TRAC+</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="tracIncentiveID">TRAC Incentive</label>
              <div style="display:flex; align-items:center; gap:.5rem;">
                <input type="checkbox" class="field-toggle" data-field="tracIncentiveID" checked />
                <select id="tracIncentiveID" name="tracIncentiveID" style="flex:1;">
                  <option value="">(none)</option>
                  <option value="1">Apply Credit as an LLPA</option>
                  <option value="2">Send Check to Borrower</option>
                  <option value="3">Apply Credit in Fees</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Boolean fields -->
          <div class="form-row">
            <div class="form-group">
              <label style="display:flex; align-items:center; gap:.5rem; cursor:pointer;">
                <input type="checkbox" class="field-toggle" data-field="includeFlexTerms" checked />
                <input type="checkbox" id="includeFlexTerms" name="includeFlexTerms" />
                Include Flex Terms
              </label>
            </div>

            <div class="form-group">
              <label style="display:flex; align-items:center; gap:.5rem; cursor:pointer;">
                <input type="checkbox" class="field-toggle" data-field="firstTimeHomeBuyer" checked />
                <input type="checkbox" id="firstTimeHomeBuyer" name="firstTimeHomeBuyer" />
                First Time Homebuyer
              </label>
            </div>

            <div class="form-group">
              <label style="display:flex; align-items:center; gap:.5rem; cursor:pointer;">
                <input type="checkbox" class="field-toggle" data-field="isDTIOver45Percent" checked />
                <input type="checkbox" id="isDTIOver45Percent" name="isDTIOver45Percent" />
                DTI Over 45%
              </label>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label style="display:flex; align-items:center; gap:.5rem; cursor:pointer;">
                <input type="checkbox" class="field-toggle" data-field="selfEmployed" checked />
                <input type="checkbox" id="selfEmployed" name="selfEmployed" />
                Self Employed
              </label>
            </div>

            <div class="form-group">
              <label style="display:flex; align-items:center; gap:.5rem; cursor:pointer;">
                <input type="checkbox" class="field-toggle" data-field="isCorrespondent" checked />
                <input type="checkbox" id="isCorrespondent" name="isCorrespondent" />
                Correspondent
              </label>
            </div>

            <div class="form-group">
              <label style="display:flex; align-items:center; gap:.5rem; cursor:pointer;">
                <input type="checkbox" class="field-toggle" data-field="isFirstTimeInvestor" checked />
                <input type="checkbox" id="isFirstTimeInvestor" name="isFirstTimeInvestor" />
                First Time Investor
              </label>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label style="display:flex; align-items:center; gap:.5rem; cursor:pointer;">
                <input type="checkbox" class="field-toggle" data-field="waiveUnderwritingFee" checked />
                <input type="checkbox" id="waiveUnderwritingFee" name="waiveUnderwritingFee" />
                Waive Underwriting Fee
              </label>
            </div>
          </div>

          <div class="builder-actions">
            <button type="button" id="previewBtn" class="btn-secondary">Preview JSON</button>
            <button type="submit" class="btn-primary">Save Payload</button>
          </div>
        </form>

        <div id="jsonPreview" class="hidden">
          <h4>JSON Preview</h4>
          <pre id="jsonContent"></pre>
        </div>
      </div>
    </section>

    <!-- ===== SCREEN 3: CUSTOMER MANAGEMENT ===== -->
    <section id="customersSection" class="tab-content">
      <div class="screen-header">
        <h2>Customer Management</h2>
        <p>Manage customers with full history tracking (SCD Type 2)</p>
      </div>

      <div class="controls">
        <div class="form-row">
          <input type="text" id="customerSearch" placeholder="Search customers..." style="flex: 2;" />
          <button id="addCustomerBtn" class="btn-primary">Add New Customer</button>
        </div>

        <div id="customerForm" class="hidden">
          <h3 id="formTitle">Add Customer</h3>
          <form id="customerFormElement">
            <input type="hidden" id="customerKey" />

            <div class="form-row">
              <div class="form-group">
                <label for="cName">Name *</label>
                <input type="text" id="cName" required />
              </div>
              <div class="form-group">
                <label for="cPhone">Phone</label>
                <input type="tel" id="cPhone" />
              </div>
              <div class="form-group">
                <label for="cEmail">Email</label>
                <input type="email" id="cEmail" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="cPayment">Current Monthly Payment ($) *</label>
                <input type="number" id="cPayment" required />
              </div>
              <div class="form-group">
                <label for="cBalance">Remaining Balance ($) *</label>
                <input type="number" id="cBalance" required />
              </div>
              <div class="form-group">
                <label for="cValue">Property Value ($) *</label>
                <input type="number" id="cValue" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="cScore">Credit Score *</label>
                <input type="number" id="cScore" min="300" max="850" required />
              </div>
              <div class="form-group">
                <label for="cIncome">Monthly Income ($) *</label>
                <input type="number" id="cIncome" required />
              </div>
              <div class="form-group">
                <label for="cZip">Zip Code *</label>
                <input type="text" id="cZip" maxlength="5" required />
                <small id="zipStatus"></small>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="cState">State (Auto-populated)</label>
                <input type="text" id="cState" maxlength="2" readonly />
              </div>
              <div class="form-group">
                <label for="cCounty">County (Auto-populated)</label>
                <input type="text" id="cCounty" readonly />
              </div>
              <div class="form-group">
                <label for="cCity">City (Auto-populated)</label>
                <input type="text" id="cCity" readonly />
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-primary">Save Customer</button>
              <button type="button" id="cancelCustomerBtn" class="btn-secondary">Cancel</button>
            </div>
          </form>
        </div>

        <div class="table-container">
          <table class="results-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Payment</th>
                <th>Credit Score</th>
                <th>Version</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="customerTableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ===== DETAILED ANALYSIS MODAL ===== -->
    <div id="analysisModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalCustomerName">Customer Analysis</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body" id="modalBody">
          <div class="loader">Loading analysis...</div>
        </div>
      </div>
    </div>

    <div class="loader-overlay hidden" id="loader">
      <div class="spinner"></div>
      <p>Analyzing...</p>
    </div>
  </div>

  <script src="/script.js"></script>
</body>
</html>